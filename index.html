<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashbook - Expense Manager</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" type="image/png" href="https://s6.imgcdn.dev/YTTHSD.th.png">
</head>

<body>
    <div class="app-container">
        <!-- Auth Modal -->
        <div id="auth-modal" class="modal show" style="z-index: 2000;">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h3 id="auth-title">Login</h3>
                </div>
                <form id="auth-form">
                    <div class="form-control">
                        <label>Username</label>
                        <input type="text" id="auth-username" required>
                    </div>
                    <div class="form-control">
                        <label>Password</label>
                        <input type="password" id="auth-password" required>
                    </div>
                    <button class="btn" id="auth-submit-btn">Login</button>
                </form>
                <p style="text-align: center; margin-top: 16px;">
                    <span id="auth-switch-text">Don't have an account?</span>
                    <a href="#" id="auth-switch-btn" style="color: var(--primary-color); font-weight: 600;">Register</a>
                </p>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="spinner"></div>
        </div>

        <!-- VIEW: HOME (Cashbooks List) -->
        <div id="view-home" class="view-section active">
            <header class="home-header">
                <div class="business-selector" id="business-selector-btn">
                    <img src="https://s6.imgcdn.dev/YTTHSD.th.png" alt="Logo"
                        style="height: 40px; margin-right: 12px; border-radius: 50%;">
                    <div class="business-icon" style="display: none;"><i class="fa-regular fa-building"></i></div>
                    <div class="business-info">
                        <span class="business-name" id="current-business-name">October</span>
                        <span class="tap-hint">Tap to switch business <i class="fa-solid fa-chevron-down"></i></span>
                    </div>
                </div>

                <div class="home-search-row">
                    <h3>Your Books</h3>
                    <div class="home-actions">
                        <div class="search-wrapper" id="search-wrapper" style="display: none; margin-right: 8px;">
                            <input type="text" id="book-search-input" placeholder="Search books..."
                                style="padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-main);">
                        </div>
                        <button class="icon-btn" id="search-toggle-btn"><i
                                class="fa-solid fa-magnifying-glass"></i></button>
                    </div>
                </div>
            </header>

            <div id="books-list" class="books-list">
                <!-- Books injected by JS -->
            </div>

            <button id="fab-add-book" class="fab-extended">
                <i class="fa-solid fa-plus"></i> ADD NEW BOOK
            </button>
        </div>

        <!-- VIEW: STATISTICS -->
        <div id="view-stats" class="view-section">
            <header class="main-header">
                <div class="header-top">
                    <button class="icon-btn back-btn" id="back-from-stats"><i
                            class="fa-solid fa-arrow-left"></i></button>
                    <div class="header-title">
                        <h1>Analytics</h1>
                    </div>
                </div>
            </header>
            <div class="content-container">
                <div class="card">
                    <h3>Income vs Expense</h3>
                    <div style="height: 250px; position: relative;">
                        <canvas id="pie-chart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>Category Spending</h3>
                    <div style="height: 250px; position: relative;">
                        <canvas id="bar-chart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>Budget Limits</h3>
                    <div id="budget-progress-container">
                        <!-- Progress bars injected by JS -->
                        <p class="empty-state">Set budgets in "Category Settings" to see progress here.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: BOOK DETAIL (Transactions) -->
        <div id="view-book" class="view-section">
            <header class="main-header">
                <div class="header-top">
                    <button class="icon-btn back-btn" id="back-to-home"><i class="fa-solid fa-arrow-left"></i></button>
                    <div class="header-title" id="book-title-container">
                        <h1 id="book-name-display">Book Name</h1>
                        <p class="subtitle">Manage your transactions</p>
                    </div>
                    <div class="header-actions">
                        <button class="icon-btn" id="stats-btn" title="Statistics"><i
                                class="fa-solid fa-chart-pie"></i></button>
                    </div>
                </div>

                <div class="filters-section">
                    <button class="filter-btn icon-only" id="reset-filters-btn"><i
                            class="fa-solid fa-sliders"></i></button>

                    <!-- Advanced Date Filter -->
                    <div class="filter-wrapper">
                        <button class="filter-btn" id="date-range-btn">This Month <i
                                class="fa-solid fa-caret-down"></i></button>
                        <div class="dropdown-menu" id="date-range-dropdown">
                            <div class="dropdown-item" data-value="today">Today</div>
                            <div class="dropdown-item" data-value="yesterday">Yesterday</div>
                            <div class="dropdown-item" data-value="this_week">This Week</div>
                            <div class="dropdown-item" data-value="last_week">Last Week</div>
                            <div class="dropdown-item" data-value="this_month">This Month</div>
                            <div class="dropdown-item" data-value="last_month">Last Month</div>
                            <div class="dropdown-item" data-value="all">All Time</div>
                            <div class="dropdown-item" data-value="custom">Custom Range</div>
                        </div>
                    </div>

                    <div class="filter-wrapper" id="custom-date-range" style="display: none; gap: 4px;">
                        <input type="date" id="start-date" class="filter-date">
                        <span style="align-self: center;">to</span>
                        <input type="date" id="end-date" class="filter-date">
                    </div>



                    <!-- Search is here too based on script? -->
                    <div class="filter-wrapper" style="flex: 1;">
                        <input type="text" id="search-input" placeholder="Search transactions..."
                            style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-main);">
                    </div>
                </div>
            </header>

            <div class="dashboard-card">
                <div class="balance-row">
                    <span>Net Balance</span>
                    <span id="balance" class="net-balance">0</span>
                </div>
                <div class="stats-row">
                    <div class="stat-item">
                        <span>Total In (+)</span>
                        <span id="money-plus" class="money plus">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Total Out (-)</span>
                        <span id="money-minus" class="money minus">0</span>
                    </div>
                </div>
                <button class="view-reports-btn" id="open-report-modal">VIEW REPORTS <i
                        class="fa-solid fa-chevron-right"></i></button>
            </div>

            <div class="transactions-section">
                <div class="list-header">
                    <span class="showing-text">Showing <span id="entry-count">0</span> entries</span>
                </div>
                <div id="list-container">
                    <!-- Date headers and lists will be injected by JS -->
                </div>
                <div id="empty-state" class="empty-state">
                    <i class="fa-solid fa-receipt"></i>
                    <p>No transactions yet</p>
                </div>
            </div>

            <div class="bottom-action-bar">
                <button id="btn-cash-in" class="action-btn cash-in">
                    <i class="fa-solid fa-plus"></i> CASH IN
                </button>
                <button id="btn-cash-out" class="action-btn cash-out">
                    <i class="fa-solid fa-minus"></i> CASH OUT
                </button>
            </div>
        </div>

        <!-- VIEW: PROFILE -->
        <div id="view-profile" class="view-section">
            <header class="main-header">
                <div class="header-top">
                    <button class="icon-btn back-btn" id="back-from-profile"><i
                            class="fa-solid fa-arrow-left"></i></button>
                    <div class="header-title">
                        <h1>Profile Settings</h1>
                    </div>
                </div>
            </header>
            <div class="profile-container" style="padding: 20px;">
                <div class="form-control">
                    <label>Name</label>
                    <input type="text" id="profile-name" placeholder="Your Name">
                </div>
                <div class="form-control">
                    <label>Mobile Number</label>
                    <input type="tel" id="profile-mobile" placeholder="Your Mobile Number">
                </div>
                <div class="form-control">
                    <label>Email</label>
                    <input type="email" id="profile-email" placeholder="Your Email">
                </div>
                <button class="btn" id="save-profile-btn" style="margin-top: 20px;">Save Profile</button>
            </div>
        </div>

        <!-- Transaction Modal -->
        <div id="transaction-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-title">Add Transaction</h3>
                    <span class="close-btn" id="close-transaction-modal">&times;</span>
                </div>
                <form id="form">
                    <input type="hidden" id="transaction-type" value="expense">
                    <div class="form-control">
                        <label for="text">Description</label>
                        <input type="text" id="text" placeholder="Enter description..." required />
                    </div>
                    <div class="form-control">
                        <label for="amount">Amount</label>
                        <input type="number" id="amount" placeholder="Enter amount..." required />
                    </div>
                    <div class="form-control">
                        <label for="category">Category</label>
                        <div style="display: flex; gap: 8px;">
                            <select id="category" style="flex: 1;">
                                <!-- Options injected by JS -->
                            </select>
                            <button type="button" id="manage-category-btn" title="Manage Categories"
                                style="padding: 0 12px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; color: var(--text-main); margin-left: 4px;">
                                <i class="fa-solid fa-gear"></i>
                            </button>
                            <button type="button" id="add-category-btn"
                                style="padding: 0 12px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; color: var(--text-main);"><i
                                    class="fa-solid fa-plus"></i></button>
                        </div>
                    </div>
                    <div class="form-control">
                        <label for="payment-mode">Payment Mode</label>
                        <select id="payment-mode">
                            <option value="Cash">Cash</option>
                            <option value="Online">Online</option>
                        </select>
                    </div>
                    <button class="btn" id="submit-btn">Save</button>
                </form>
            </div>
        </div>

        <!-- Report Modal -->
        <div id="report-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Generate Report</h3>
                    <span class="close-btn" id="close-report-modal">&times;</span>
                </div>

                <div class="report-options">
                    <label class="report-option active">
                        <input type="radio" name="report-type" value="all" checked>
                        <div class="option-content">
                            <span class="option-title">All Entries Report</span>
                            <span class="option-desc">List of all entries and details</span>
                        </div>
                    </label>
                    <label class="report-option">
                        <input type="radio" name="report-type" value="day">
                        <div class="option-content">
                            <span class="option-title">Day-wise summary</span>
                            <span class="option-desc">Day-wise total in, out & balance</span>
                        </div>
                    </label>
                    <label class="report-option">
                        <input type="radio" name="report-type" value="category">
                        <div class="option-content">
                            <span class="option-title">Category-wise summary</span>
                            <span class="option-desc">Income & expenses of all categories</span>
                        </div>
                    </label>
                </div>

                <div class="report-actions">
                    <button class="report-btn outline" id="generate-excel-btn">
                        <i class="fa-solid fa-table"></i> GENERATE EXCEL
                    </button>
                    <button class="report-btn primary" id="generate-pdf-btn">
                        <i class="fa-solid fa-file-pdf"></i> GENERATE PDF
                    </button>
                </div>
            </div>
        </div>

        <!-- Business Modal -->
        <div id="business-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Select Business</h3>
                    <span class="close-btn" id="close-business-modal">&times;</span>
                </div>
                <div id="business-list" class="business-list">
                    <!-- Businesses injected by JS -->
                </div>
                <button class="btn" id="add-business-btn" style="margin-top: 16px;">
                    <i class="fa-solid fa-plus"></i> ADD NEW BUSINESS
                </button>
            </div>
        </div>

        <!-- Category Manager Modal -->
        <div id="category-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Manage Categories</h3>
                    <span class="close-btn" id="close-category-modal">&times;</span>
                </div>
                <div id="category-list" class="business-list">
                    <!-- Categories injected by JS -->
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-item active" id="nav-cashbooks">
                <i class="fa-solid fa-book"></i>
                <span>Cashbooks</span>
            </div>
            <div class="nav-item" id="nav-settings">
                <i class="fa-solid fa-gear"></i>
                <span>Settings</span>
            </div>
        </nav>
    </div>

    <script src="script.js"></script>
</body>

</html>